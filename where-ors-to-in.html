<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <title>WHERE ORs to IN</title>
    <style>
      body{ background:transparent; color:#dfe; font-family: sans-serif; padding:18px }
      textarea{ width:100%; height:220px; background:#0f0f0f; color:#dbecc8; border:1px solid rgba(181,232,83,0.12); padding:12px; border-radius:6px }
      .btn{ padding:8px 12px; border-radius:6px; cursor:pointer; background:linear-gradient(#222,#111); color:#dfe; border:1px solid rgba(0,0,0,0.6) }
    </style>
  </head>
  <body>
    <h1>WHERE ORs â†’ IN</h1>
    <label>Input (includes full SQL)</label>
    <textarea id="input" placeholder="Paste SQL with a WHERE clause here..."></textarea>
    <div style="margin-top:8px; display:flex; gap:8px">
      <button class="btn" onclick="whereOrsToIn()">Convert</button>
      <button class="btn" onclick="clearAll()">Clear</button>
    </div>

    <h3>Result</h3>
    <textarea id="result" readonly placeholder="Result will appear here..."></textarea>
    <div style="margin-top:8px; display:flex; gap:8px">
      <button class="btn" onclick="copyResult()">Copy</button>
      <button class="btn" onclick="replaceInputWithResult()">Replace input</button>
    </div>

    <script>
      function getInput(){ return document.getElementById('input').value }
      function setResult(v){ document.getElementById('result').value = v }

      function whereOrsToIn(){
        const raw = getInput(); if(!raw) return setResult('');
        const m = raw.match(/(\bWHERE\b\s*)([\s\S]*?)(?=(?:\b(?:GROUP BY|ORDER BY|LIMIT|HAVING|UNION)\b|$))/i);
        if(!m) return setResult(raw);
        const whereKeyword = m[1];
        const whereBody = m[2].replace(/;+\s*$/,'').trim();
        const parts = whereBody.split(/\s+OR\s+/i).map(p=>p.trim());
        const eqRegex = /^([`"']?\w+[`"']?)\s*=\s*(['"]?)([\s\S]*?)\2$/;
        const parsed = parts.map(p=>{ const mm = p.match(eqRegex); return mm ? { raw:p, col: mm[1].replace(/^[`"']|[`"']$/g,''), val: mm[3] } : null });
        if(parsed.some(x=>x===null)) return setResult(raw);
        const colMap = {}; const valMap = {};
        parsed.forEach(p=>{ colMap[p.col]=colMap[p.col]||[]; if(!colMap[p.col].includes(p.val)) colMap[p.col].push(p.val); valMap[p.val]=valMap[p.val]||[]; if(!valMap[p.val].includes(p.col)) valMap[p.val].push(p.col); });
        const used = new Set(); const exprs=[];
        for(const col in colMap){ if(colMap[col].length>1){ const values = colMap[col].map(v=>{ const isNum = /^[-+]?\d+(?:\.\d+)?$/.test(v); const escaped = v.replace(/'/g, "''"); return isNum ? escaped : "'"+escaped+"'" }); exprs.push(`${col} IN(${values.join(', ')})`); parsed.forEach(p=>{ if(p.col===col) used.add(p) }); } }
        for(const val in valMap){ if(valMap[val].length>1){ const cols = valMap[val].filter(c => !colMap[c] || colMap[c].length === 1); if(cols.length>1){ const isNum = /^[-+]?\d+(?:\.\d+)?$/.test(val); const escaped = val.replace(/'/g, "''"); const valueLiteral = isNum ? escaped : "'"+escaped+"'"; exprs.push(`${valueLiteral} IN(${cols.join(', ')})`); parsed.forEach(p=>{ if(p.val===val && cols.includes(p.col)) used.add(p) }); } } }
        parsed.forEach(p=>{ if(!used.has(p)){ const isNum = /^[-+]?\d+(?:\.\d+)?$/.test(p.val); const escaped = p.val.replace(/'/g, "''"); const valueLiteral = isNum ? escaped : "'"+escaped+"'"; exprs.push(`${p.col} = ${valueLiteral}`) } });
        const newWhere = exprs.join(' OR ');
        const replaced = raw.replace(m[0], whereKeyword + newWhere + ' ');
        setResult(replaced);
      }

      function copyResult(){ const r = document.getElementById('result'); r.select(); document.execCommand('copy') }
      function replaceInputWithResult(){ const r = document.getElementById('result').value; if(!r) return; document.getElementById('input').value = r; setResult('') }
      function clearAll(){ document.getElementById('input').value=''; setResult('') }
    </script>
  </body>
</html>