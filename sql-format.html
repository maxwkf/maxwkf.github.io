<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <title>SQL Formatter</title>
    <style>
      body{ background:transparent; color:#dfe; font-family: sans-serif; padding:18px }
      textarea{ width:100%; height:220px; background:#0f0f0f; color:#dbecc8; border:1px solid rgba(181,232,83,0.12); padding:12px; border-radius:6px }
      .btn{ padding:8px 12px; border-radius:6px; cursor:pointer; background:linear-gradient(#2b5,#174); color:#071; border:1px solid rgba(16,120,40,0.6) }
    </style>
  </head>
  <body>
    <h1>SQL Formatter</h1>
    <label>Input</label>
    <textarea id="input" placeholder="Paste SQL here..."></textarea>
    <div style="margin-top:8px; display:flex; gap:8px">
      <button class="btn" onclick="formatSQL()">Format SQL</button>
      <button class="btn" style="background:linear-gradient(#222,#111); color:#dfe" onclick="clearAll()">Clear</button>
    </div>

    <h3>Result</h3>
    <textarea id="result" readonly placeholder="Result will appear here..."></textarea>
    <div style="margin-top:8px; display:flex; gap:8px">
      <button class="btn" style="background:linear-gradient(#222,#111); color:#dfe" onclick="copyResult()">Copy</button>
      <button class="btn" style="background:linear-gradient(#222,#111); color:#dfe" onclick="replaceInputWithResult()">Replace input</button>
    </div>

    <script>
      function getInput(){ return document.getElementById('input').value }
      function setResult(v){ document.getElementById('result').value = v }

      function formatSQL(){
        let sql = getInput();
        if(!sql) return setResult('');
        sql = sql.replace(/\s+/g, ' ').trim();
        const keywords = [
          'SELECT','FROM','WHERE','GROUP BY','ORDER BY','HAVING','LIMIT',
          'INSERT INTO','VALUES','UPDATE','SET','DELETE','JOIN','INNER JOIN','LEFT JOIN','RIGHT JOIN','FULL JOIN','ON',
          'UNION ALL','UNION','CREATE TABLE','ALTER TABLE','DROP TABLE','WITH'
        ];
        keywords.sort((a,b)=>b.length-a.length);
        keywords.forEach(k => {
          const re = new RegExp('\\b' + k.replace(/ /g,'\\s+') + '\\b','ig');
          sql = sql.replace(re, '\n' + k);
        });
        const lines = sql.split(/\n+/).map(l=>l.trim()).filter(Boolean);
        const formatted = [];
        for(const line of lines){
          const upper = line.toUpperCase();
          if(/^SELECT\b/i.test(upper)){
            const rest = line.replace(/^SELECT\b\s*/i,'');
            if(!rest){ formatted.push('SELECT'); }
            else{ const cols = rest.split(/\s*,\s*/); formatted.push('SELECT'); cols.forEach((c,idx)=>{ const suffix = idx < cols.length-1 ? ',' : ''; formatted.push('  '+c+suffix); }); }
            continue;
          }
          if(/^(JOIN|INNER JOIN|LEFT JOIN|RIGHT JOIN|FULL JOIN)\b/i.test(upper)) { formatted.push('  '+line); continue; }
          if(/^ON\b/i.test(upper)) { formatted.push('    '+line); continue; }
          formatted.push(line);
        }
        const out = formatted.map(l=>{
          for(const k of keywords){ const re = new RegExp('^'+k.replace(/ /g,'\\s+'),'i'); if(re.test(l)) return l.replace(re,k); }
          return l;
        }).join('\n');
        setResult(out);
      }

      function copyResult(){ const r = document.getElementById('result'); r.select(); document.execCommand('copy') }
      function replaceInputWithResult(){ const r = document.getElementById('result').value; if(!r) return; document.getElementById('input').value = r; setResult('') }
      function clearAll(){ document.getElementById('input').value=''; setResult('') }
    </script>
  </body>
</html>